sap.ui.define(["plentyHolidays/controller/BaseController","sap/ui/model/json/JSONModel"],function(e,t){"use strict";return e.extend("plentyHolidays.controller.Main",{onInit:function(){var e=new t({TotalTourCost:0,RoundFlights:[],RoundHotels:[],EditObject:"",SortedTourList:[],UnSortedTourList:[]});this.getView().setModel(e,"mainView")},onSelectTabBar:function(e){var t=e.getSource().getSelectedKey();if(t==="Hotel"){if(!this._oViewHotelDialog){this._oViewHotelDialog=sap.ui.xmlfragment("plentyHolidays.view.Hotel",this);this.getView().addDependent(this._oViewHotelDialog);this._oViewHotelDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewHotelDialog.open()}else if(t==="Transfer"){if(!this._oViewTransferDialog){this._oViewTransferDialog=sap.ui.xmlfragment("plentyHolidays.view.Transfer",this);this.getView().addDependent(this._oViewTransferDialog);this._oViewTransferDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewTransferDialog.open()}else if(t==="Activity"){if(!this._oViewActivityDialog){this._oViewActivityDialog=sap.ui.xmlfragment("plentyHolidays.view.Activity",this);this.getView().addDependent(this._oViewActivityDialog);this._oViewActivityDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewActivityDialog.open()}else if(t==="Freeday"){if(!this._oViewFreeDayDialog){this._oViewFreeDayDialog=sap.ui.xmlfragment("plentyHolidays.view.Freeday",this);this.getView().addDependent(this._oViewFreeDayDialog);this._oViewFreeDayDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewFreeDayDialog.open()}else if(t==="Visa"){if(!this._oViewVisaDialog){this._oViewVisaDialog=sap.ui.xmlfragment("plentyHolidays.view.Visa",this);this.getView().addDependent(this._oViewVisaDialog);this._oViewVisaDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewVisaDialog.open()}else if(t==="Flight"){if(!this._oViewFlightDialog){this._oViewFlightDialog=sap.ui.xmlfragment("plentyHolidays.view.Flight",this);this.getView().addDependent(this._oViewFlightDialog);this._oViewFlightDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewFlightDialog.open()}else if(t==="Reset"){this.getModel("mainView").setProperty("/TotalTourCost",0);this.getModel("mainView").setProperty("/UnSortedTourList",[]);this.getModel("mainView").setProperty("/SortedTourList",[])}},_handleValueHelpCloseForHotel:function(){this._oViewHotelDialog.close();this.getModel("mainView").setProperty("/EditObject","")},_handleValueHelpCloseForTransfer:function(){this._oViewTransferDialog.close();this.getModel("mainView").setProperty("/EditObject","")},_handleValueHelpCloseForActivity:function(){this._oViewActivityDialog.close();this.getModel("mainView").setProperty("/EditObject","")},_handleValueHelpCloseForVisa:function(){this._oViewVisaDialog.close();this.getModel("mainView").setProperty("/EditObject","")},_handleValueHelpCloseForFreeday:function(){this._oViewFreeDayDialog.close();this.getModel("mainView").setProperty("/EditObject","")},_handleValueHelpCloseForFlight:function(){this._oViewFlightDialog.close();this.getModel("mainView").setProperty("/EditObject","")},onBeforOpenFreeDay:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject");var t=sap.ui.getCore();t.byId("FreedayDP1").setValue(e.Info.PlanningDate);t.byId("InputFreedaySuggestions").setValue(e.Info.Suggestion)}},onBeforOpenVisa:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject");var t=sap.ui.getCore();t.byId("inputVisaCountryName").setValue(e.Info.CountryName);t.byId("InputVisaAmount").setValue(this.removeCommas(e.Info.Fees));t.byId("inputVisanumberofadult").setValue(e.Info.Adult);t.byId("inputVisaTotalPrice").setValue(this.removeCommas(e.Info.TotalPrice))}},onBeforOpenFlight:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject");var t=this.getModel("mainView").getProperty("/SortedTourList");var i={};if(e.Index!==0){i=t[this.onFindFirstIndexForRoundFlight(e.ID)]}else if(e.Index===0){i=t[e.Index]}var r=sap.ui.getCore();r.byId("inputFlightOrigin").setValue(i.origin);r.byId("inputFlightDestination").setValue(i.destination);r.byId("inputFlightDepartureDateTime").setValue(i.departuredatetime);r.byId("inputFlightReturnDateTime").setValue(i.returndatetime);r.byId("inputDepartureFlightNumber").setValue(i.departureflightnumber);r.byId("inputReturnFlightNumber").setValue(i.returnflightnumber);r.byId("inputFlightAdult").setValue(i.numberofadult);r.byId("inputFlightAdultPrice").setValue(i.adultprice);r.byId("inputFlightChild").setValue(i.numberofchild);r.byId("inputFlightChildPrice").setValue(i.childprice);r.byId("inputFlightInfant").setValue(i.numberofinfant);r.byId("inputFlightInfantPrice").setValue(i.infantprice);r.byId("inputFlightTotalPrice").setValue(i.price);r.byId("inputFlightRemarks").setValue(i.remarks)}},onBeforOpenHotel:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject");var t=this.getModel("mainView").getProperty("/SortedTourList");var i={};if(e.Index!==0){i=t[this.onFindFirstIndexForHotel(e.ID)]}else if(e.Index===0){i=t[e.Index]}var r=sap.ui.getCore();r.byId("DRS1").setValue(i.checkinoutdate);r.byId("inputDesctination").setValue(i.hotellocation);r.byId("inputHotelName").setValue(i.hotelname);r.byId("inputRoomType").setValue(i.roomtype);r.byId("inputRoomPrice").setValue(this.removeCommas(i.roomperdayprice));r.byId("inputRooms").setValue(i.numberofrooms);r.byId("inputExtraBeds").setValue(i.numberofextrabed);r.byId("inputNumberOfNights").setValue(i.numberofnight);r.byId("inputTotalPrice").setValue(this.removeCommas(i.price));r.byId("inputhotelnumberofadult").setValue(i.numberofadult);r.byId("inputhotelnumberofchild").setValue(i.numberofchild);r.byId("inputBookingId").setValue(i.confirmationnumber);r.byId("inputhoteladdress").setValue(i.hoteladdress);r.byId("inputExtraBedPrice").setValue(this.removeCommas(i.extrabedprice));r.byId("inputHotelRemarks").setValue(i.remarks);r.byId("TP1").setValue(i.checkintime);r.byId("TP2").setValue(i.checkouttime);if(i.breakfast==="Y"){r.byId("htlBreakfast").setSelectedIndex(0)}else{r.byId("htlBreakfast").setSelectedIndex(1)}}},onBeforOpenTransfer:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject");var t=sap.ui.getCore();t.byId("inputTransferFrom").setValue(e.Info.Origin);t.byId("inputTransferTo").setValue(e.Info.Destination);t.byId("inputTransferVeichleType").setSelectedKey(e.Info.VehicleType);t.byId("inputTransferNumberofVechile").setValue(e.Info.NumberofVehicle);t.byId("inputTransferPrice").setValue(this.removeCommas(e.Info.IndividualPrice));t.byId("inputTransferpickupdatetime").setValue(e.Info.PickUpDateTime);t.byId("inputTransferPickupzone").setValue(e.Info.PickupZone);t.byId("inputTransferTotalPrice").setValue(this.removeCommas(e.Info.Price));t.byId("inputTransferRemarks").setValue(e.Info.Remarks)}},onBeforOpenActivity:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject");var t=sap.ui.getCore();t.byId("inputActivityDestination").setValue(e.Info.Origin);t.byId("inputActivity").setValue(e.Info.ActivityName);t.byId("inputActivityAdultPrice").setValue(this.removeCommas(e.Info.AdultTicketPrice));t.byId("inputActivityAdult").setValue(e.Info.Adult);t.byId("inputActivityChildPrice").setValue(this.removeCommas(e.Info.ChildTicketPrice));t.byId("inputActivityChild").setValue(e.Info.Child);t.byId("inputActivityDuration").setValue(e.Info.Duration);t.byId("inputActivityOptions").setValue(e.Info.Option);t.byId("inputActivitypickupdatetime").setValue(e.Info.PickUpDateTime);t.byId("inputActivityPickupzone").setValue(e.Info.PickupZone);t.byId("inputActivityTotalPrice").setValue(this.removeCommas(e.Info.TotalPrice));t.byId("inputActivityRemarks").setValue(e.Info.Remarks);t.byId("btnActivity").setEnabled(true)}},onChangeRoomPrice:function(e){var t=sap.ui.getCore();t.byId("btnHotel").setEnabled(false);t.byId("DRS1").setValue("");if(parseInt(e.getSource().getValue(),10)>0){t.byId("inputRooms").setEnabled(true);t.byId("DRS1").setEnabled(true);t.byId("inputTotalPrice").setValue("");t.byId("inputNumberOfNights").setValue(0)}else{t.byId("inputRooms").setEnabled(false);t.byId("DRS1").setEnabled(false);t.byId("DRS1").setValue("");t.byId("inputTotalPrice").setValue("");t.byId("inputNumberOfNights").setValue(0)}},onChangeInputRooms:function(e){var t=sap.ui.getCore();t.byId("inputNumberOfNights").setValue(0);t.byId("inputTotalPrice").setValue("");t.byId("DRS1").setEnabled(true);t.byId("DRS1").setValue("");t.byId("btnHotel").setEnabled(false)},onChangeExtraBed:function(e){var t=sap.ui.getCore();t.byId("inputNumberOfNights").setValue(0);t.byId("inputTotalPrice").setValue("");t.byId("DRS1").setEnabled(true);t.byId("DRS1").setValue("");t.byId("btnHotel").setEnabled(false)},onChangeExtraBedPrice:function(e){var t=sap.ui.getCore();t.byId("btnHotel").setEnabled(false);t.byId("DRS1").setValue("");if(parseInt(e.getSource().getValue(),10)>0){t.byId("inputExtraBeds").setEnabled(true);t.byId("inputExtraBeds").setValue(1);t.byId("DRS1").setEnabled(true);t.byId("DRS1").setValue("");t.byId("inputTotalPrice").setValue("");t.byId("inputNumberOfNights").setValue(0)}else{t.byId("inputExtraBeds").setEnabled(false);t.byId("inputExtraBeds").setValue(0);t.byId("DRS1").setEnabled(false);t.byId("DRS1").setValue("");t.byId("inputTotalPrice").setValue("");t.byId("inputNumberOfNights").setValue(0)}if(e.getSource().getValue().length===0){t.byId("DRS1").setEnabled(true);t.byId("DRS1").setValue("")}},onDateSelection:function(e){var t=0;var i=e.getSource().getValue();var r=sap.ui.getCore();var a=this.dateDiff(new Date(i.split("@")[0].trim()),new Date(i.split("@")[1].trim()));r.byId("inputNumberOfNights").setValue(a.d);var n=r.byId("inputRoomPrice").getValue();var o=r.byId("inputRooms").getValue();var l=r.byId("inputExtraBeds").getValue();var u=r.byId("inputExtraBedPrice").getValue();t=o*parseInt(n,10);if(l>0){t+=l*parseInt(u,10)}r.byId("inputTotalPrice").setValue(a.d*t);r.byId("btnHotel").setEnabled(true)},onChangeFlightNoOfAdult:function(e){var t=sap.ui.getCore();var i=e.getSource().getValue();var r=t.byId("inputFlightAdultPrice").getValue();var a=t.byId("inputFlightChild").getValue();var n=t.byId("inputFlightChildPrice").getValue();var o=t.byId("inputFlightInfant").getValue();var l=t.byId("inputFlightInfantPrice").getValue();var u=i*r+a*n+o*l;t.byId("inputFlightTotalPrice").setValue(u)},onChangeFlightNoOfChild:function(e){var t=sap.ui.getCore();var i=t.byId("inputFlightAdultPrice").getValue();var r=t.byId("inputFlightAdult").getValue();var a=e.getSource().getValue();var n=t.byId("inputFlightChildPrice").getValue();var o=t.byId("inputFlightInfant").getValue();var l=t.byId("inputFlightInfantPrice").getValue();var u=r*i+a*n+o*l;t.byId("inputFlightTotalPrice").setValue(u)},onChangeFlightNoOfInfant:function(e){var t=sap.ui.getCore();var i=t.byId("inputFlightAdult").getValue();var r=t.byId("inputFlightAdultPrice").getValue();var a=e.getSource().getValue();var n=t.byId("inputFlightInfantPrice").getValue();var o=t.byId("inputFlightChild").getValue();var l=t.byId("inputFlightChildPrice").getValue();var u=i*r+o*l+a*n;t.byId("inputFlightTotalPrice").setValue(u)},onChangeFlightAdultUnitPrice:function(e){var t=sap.ui.getCore();var i=t.byId("inputFlightAdult").getValue();var r=e.getSource().getValue();var a=t.byId("inputFlightInfant").getValue();var n=t.byId("inputFlightInfantPrice").getValue();var o=t.byId("inputFlightChild").getValue();var l=t.byId("inputFlightChildPrice").getValue();var u=i*r+o*l+a*n;t.byId("inputFlightTotalPrice").setValue(u)},onChangeFlightChildUnitPrice:function(e){var t=sap.ui.getCore();var i=t.byId("inputFlightAdult").getValue();var r=t.byId("inputFlightAdultPrice").getValue();var a=t.byId("inputFlightChild").getValue();var n=e.getSource().getValue();var o=t.byId("inputFlightInfant").getValue();var l=t.byId("inputFlightInfantPrice").getValue();var u=i*r+a*n+o*l;t.byId("inputFlightTotalPrice").setValue(u)},onChangeFlightInfantUnitPrice:function(e){var t=sap.ui.getCore();var i=t.byId("inputFlightAdult").getValue();var r=t.byId("inputFlightAdultPrice").getValue();var a=t.byId("inputFlightChild").getValue();var n=t.byId("inputFlightChildPrice").getValue();var o=t.byId("inputFlightInfant").getValue();var l=e.getSource().getValue();var u=i*r+a*n+o*l;t.byId("inputFlightTotalPrice").setValue(u)},onConfirmFlight:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject").ID;var t=this.getModel("mainView").getProperty("/UnSortedTourList");var i=t.map(function(e){return e.objectid}).indexOf(e);t.splice(i,1);var r=t.map(function(e){return e.objectid}).indexOf(e);if(r!==-1){t.splice(r,1)}this.getModel("mainView").setProperty("/EditObject","")}var a={},n=sap.ui.getCore();a.Origin=n.byId("inputFlightOrigin").getValue();a.Destination=n.byId("inputFlightDestination").getValue();a.DepartureDateTime=n.byId("inputFlightDepartureDateTime").getValue();a.DepartureDate=this.convertTodateValue(new Date(n.byId("inputFlightDepartureDateTime").getDateValue()));a.DepartureTime=n.byId("inputFlightDepartureDateTime").getValue().split(" ")[3];a.ReturnDateTime=n.byId("inputFlightReturnDateTime").getValue();a.ReturnDate=this.convertTodateValue(new Date(n.byId("inputFlightReturnDateTime").getDateValue()));a.ReturnTime=n.byId("inputFlightReturnDateTime").getValue().split(" ")[3];a.DepartureFlightNo=n.byId("inputDepartureFlightNumber").getValue();a.ReturnFlightNo=n.byId("inputReturnFlightNumber").getValue();a.CarrierName=n.byId("inputFlightCarrrierName").getValue();a.NumberOfAdult=n.byId("inputFlightAdult").getValue();a.PerAdultPrice=n.byId("inputFlightAdultPrice").getValue();a.NumberOfChild=n.byId("inputFlightChild").getValue();a.PerChildPrice=n.byId("inputFlightChildPrice").getValue();a.NumberOfInfant=n.byId("inputFlightInfant").getValue();a.PerInfantPrice=n.byId("inputFlightInfantPrice").getValue();a.TotalPrice=n.byId("inputFlightTotalPrice").getValue();a.Remarks=n.byId("inputFlightRemarks").getValue();var o={};o.objectid=this.onGetrandomNumber();o.actiondatetime=a.DepartureDate+" "+a.DepartureTime;o.planningdate=a.DepartureDate;o.origin=a.Origin;o.destination=a.Destination;o.departuredatetime=a.DepartureDateTime;o.departuredate=a.DepartureDate;o.departuretime=a.DepartureTime;if(a.ReturnDateTime!==""){o.flighttype="round";o.returndatetime=a.ReturnDateTime;o.returndate=a.ReturnDate;o.returntime=a.ReturnTime}else{o.flighttype="oneway";o.returndate="";o.returntime=""}o.type="Flight";o.departureflightnumber=a.DepartureFlightNo;o.returnflightnumber=a.ReturnFlightNo;o.carriername=a.CarrierName;o.numberofadult=a.NumberOfAdult;o.adultprice=a.PerAdultPrice===""?"0":a.PerAdultPrice;o.numberofchild=a.NumberOfChild;o.childprice=a.PerChildPrice===""?"0":a.PerChildPrice;o.numberofinfant=a.NumberOfInfant;o.infantprice=a.PerInfantPrice===""?"0":a.PerInfantPrice;o.price=a.TotalPrice;o.remarks=a.Remarks;o.currency="BDT";this.getModel("mainView").getProperty("/UnSortedTourList").push(o);if(o.flighttype==="round"){var l={};l.objectid=o.objectid;l.actiondatetime=a.ReturnDate+" "+a.ReturnTime;l.planningdate=a.ReturnDate;l.departuredatetime=a.ReturnDateTime;l.departuredate=a.ReturnDate;l.departuretime=a.ReturnTime;l.flightnumber=a.ReturnFlightNo;l.departureflightnumber=a.ReturnFlightNo;l.origin=a.Destination;l.destination=a.Origin;l.type="Flight";l.carriername=a.CarrierName;l.numberofadult=a.NumberOfAdult;l.adultprice=a.PerAdultPrice===""?"0":a.PerAdultPrice;l.numberofchild=a.NumberOfChild;l.childprice=a.PerChildPrice===""?"0":a.PerChildPrice;l.numberofinfant=a.NumberOfInfant;l.infantprice=a.PerInfantPrice===""?"0":a.PerInfantPrice;l.remarks=a.Remarks;l.currency="BDT";l.flighttype="round";l.price=a.TotalPrice;l.returndatetime="";l.returndate="";l.retruntime="";l.returnflightnumber="";this.getModel("mainView").getProperty("/UnSortedTourList").push(l)}this.onFormatTableData();this._handleValueHelpCloseForFlight()},onConfirmHotel:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject").ID;var t=this.getModel("mainView").getProperty("/UnSortedTourList");var i=t.map(function(e){return e.objectid}).indexOf(e);t.splice(i,1);var r=t.map(function(e){return e.objectid}).indexOf(e);if(r!==-1){t.splice(r,1)}this.getModel("mainView").setProperty("/EditObject","")}var a={},n=sap.ui.getCore();a.Destination=n.byId("inputDesctination").getValue();a.HotelName=n.byId("inputHotelName").getValue();a.RoomType=n.byId("inputRoomType").getValue();a.RoomPrice=n.byId("inputRoomPrice").getValue();a.NumberOfRooms=n.byId("inputRooms").getValue();a.ExtraBed=n.byId("inputExtraBeds").getValue();a.CheckInDate=this.convertTodateValue(new Date(n.byId("DRS1").getValue().split("@")[0].trim()));a.CheckOutDate=this.convertTodateValue(new Date(n.byId("DRS1").getValue().split("@")[1].trim()));a.CheckInOutDate=n.byId("DRS1").getValue();a.NumberOfNight=n.byId("inputNumberOfNights").getValue();a.TotalPrice=n.byId("inputTotalPrice").getValue();a.NumberOfAdult=n.byId("inputhotelnumberofadult").getValue();a.NumberOfChild=n.byId("inputhotelnumberofchild").getValue();a.ConfirmationiNumber=n.byId("inputBookingId").getValue();a.HotelAddress=n.byId("inputhoteladdress").getValue();a.ExtraBedPrice=n.byId("inputExtraBedPrice").getValue();a.Remarks=n.byId("inputHotelRemarks").getValue();a.CheckInTime=n.byId("TP1").getValue();a.CheckOutTime=n.byId("TP2").getValue();a.Breakfast=n.byId("htlBreakfast").getSelectedIndex()===0?"Y":"N";var o={};o.objectid=this.onGetrandomNumber();o.actiondatetime=a.CheckInDate+" "+a.CheckInTime;o.planningdate=a.CheckInDate;o.roomtype=a.RoomType;o.type="Hotel";o.hotelname=a.HotelName;o.hotellocation=a.Destination;o.checkindate=a.CheckInDate;o.checkintime=a.CheckInTime;o.checkouttime=a.CheckOutTime;o.checkoutdate=a.CheckOutDate;o.checkinoutdate=a.CheckInOutDate;o.price=a.TotalPrice;o.currency="BDT";o.numberofadult=a.NumberOfAdult;o.numberofchild=a.NumberOfChild;o.confirmationnumber=a.ConfirmationiNumber;o.hoteladdress=a.HotelAddress;o.numberofextrabed=a.ExtraBed;o.numberofrooms=a.NumberOfRooms;o.roomperdayprice=a.RoomPrice===""?"0":a.RoomPrice;o.extrabedprice=a.ExtraBedPrice===""?"0":a.ExtraBedPrice;o.remarks=a.Remarks;o.numberofnight=a.NumberOfNight;o.breakfast=a.Breakfast;this.getModel("mainView").getProperty("/UnSortedTourList").push(o);var l={};l.objectid=o.objectid;l.actiondatetime=a.CheckOutDate+" "+a.CheckOutTime;l.planningdate=a.CheckOutDate;l.roomtype=a.RoomType;l.type="Hotel";l.hotelname=a.HotelName;l.hotellocation=a.Destination;l.checkindate=a.CheckInDate;l.checkintime=a.CheckInTime;l.checkouttime=a.CheckOutTime;l.checkoutdate=a.CheckOutDate;l.checkinoutdate=a.CheckInOutDate;l.price=a.TotalPrice;l.currency="BDT";l.numberofadult=a.NumberOfAdult;l.numberofchild=a.NumberOfChild;l.confirmationnumber=a.ConfirmationiNumber;l.hoteladdress=a.HotelAddress;l.numberofextrabed=a.ExtraBed;l.numberofrooms=a.NumberOfRooms;l.roomperdayprice=a.RoomPrice===""?"0":a.RoomPrice;l.extrabedprice=a.ExtraBedPrice===""?"0":a.ExtraBedPrice;l.remarks=a.Remarks;l.numberofnight=a.NumberOfNight;l.breakfast=a.Breakfast;this.getModel("mainView").getProperty("/UnSortedTourList").push(l);this.onFormatTableData();this._handleValueHelpCloseForHotel()},handleChangeForTransferDate:function(){var e=sap.ui.getCore();e.byId("btnTransfer").setEnabled(true)},onChangeVeichle:function(e){var t=sap.ui.getCore();var i=t.byId("inputTransferPrice").getValue();t.byId("inputTransferTotalPrice").setValue(i*e.getSource().getValue())},onLiveChnageTransferPrice:function(e){var t=sap.ui.getCore();if(e.getSource().getValue()>0){var i=0;var r=t.byId("inputTransferNumberofVechile").getValue();i=r*e.getSource().getValue();t.byId("inputTransferTotalPrice").setValue(i)}else{t.byId("inputTransferTotalPrice").setValue(0)}},onConfirmTransfer:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject").ID;var t=this.getModel("mainView").getProperty("/UnSortedTourList");var i=t.map(function(e){return e.objectid}).indexOf(e);t.splice(i,1)}var r={},a=sap.ui.getCore();r.From=a.byId("inputTransferFrom").getValue();r.To=a.byId("inputTransferTo").getValue();r.VehicleType=a.byId("inputTransferVeichleType").getSelectedKey();r.NumberOfVeichle=a.byId("inputTransferNumberofVechile").getValue();r.IndividualPrice=a.byId("inputTransferPrice").getValue();r.PickUpDateTime=a.byId("inputTransferpickupdatetime").getValue();r.PickUpDate=this.convertTodateValue(new Date(a.byId("inputTransferpickupdatetime").getDateValue()));r.PickUpTime=a.byId("inputTransferpickupdatetime").getValue().split(" ")[3];r.PickupZone=a.byId("inputTransferPickupzone").getValue();r.TotalPrice=a.byId("inputTransferTotalPrice").getValue();r.Remarks=a.byId("inputTransferRemarks").getValue();var n={};n.objectid=this.onGetrandomNumber();n.actiondatetime=r.PickUpDate+" "+r.PickUpTime;n.planningdate=r.PickUpDate;n.vechileservicetype="single";n.origin=r.From;n.destination=r.To;n.picuptime=r.PickUpTime;n.pickupdatetime=r.PickUpDateTime;n.picupzone=r.PickupZone;n.price=r.TotalPrice;n.individualprice=r.IndividualPrice;n.type="Transfer";n.vehicletype=r.VehicleType;n.numberofvehicle=r.NumberOfVeichle;n.remarks=r.Remarks;n.currency="BDT";this.getModel("mainView").getProperty("/UnSortedTourList").push(n);this.onFormatTableData();this._handleValueHelpCloseForTransfer()},onLiveChangeActivityAdultPrice:function(e){var t=sap.ui.getCore();if(e.getSource().getValue()>0){var i=0;var r=t.byId("inputActivityAdult").getValue();var a=t.byId("inputActivityChild").getValue();var n=t.byId("inputActivityChildPrice").getValue();i=r*e.getSource().getValue();if(n>0&&a>0){i+=n*a}t.byId("inputActivityTotalPrice").setValue(i);t.byId("btnActivity").setEnabled(true)}else{t.byId("inputActivityChildPrice").setValue(0);t.byId("inputActivityChild").setValue(0);t.byId("inputActivityTotalPrice").setValue(0);t.byId("btnActivity").setEnabled(false)}},onLiveChangeActivityChildPrice:function(e){var t=sap.ui.getCore();var i=0;var r=t.byId("inputActivityAdult").getValue();var a=t.byId("inputActivityChild").getValue();var n=t.byId("inputActivityAdultPrice").getValue();if(e.getSource().getValue()>0){i=a*e.getSource().getValue();if(n>0&&r>0){i+=n*r}t.byId("inputActivityTotalPrice").setValue(i)}else{i=n*r;t.byId("inputActivityTotalPrice").setValue(i)}},onChangeActivityAdultNumber:function(e){var t=sap.ui.getCore();var i=0;var r=t.byId("inputActivityChild").getValue();var a=t.byId("inputActivityAdultPrice").getValue();var n=t.byId("inputActivityChildPrice").getValue();if(a>0){i=a*e.getSource().getValue()}if(n>0&&r>0){i+=n*r}t.byId("inputActivityTotalPrice").setValue(i)},onChangeActivityChildNumber:function(e){var t=sap.ui.getCore();var i=0;var r=t.byId("inputActivityAdult").getValue();var a=t.byId("inputActivityAdultPrice").getValue();var n=t.byId("inputActivityChildPrice").getValue();if(a>0&&r>0){i=a*r}if(n>0&&e.getSource().getValue()>0){i+=n*e.getSource().getValue()}t.byId("inputActivityTotalPrice").setValue(i)},onConfirmActivity:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject").ID;var t=this.getModel("mainView").getProperty("/UnSortedTourList");var i=t.map(function(e){return e.objectid}).indexOf(e);t.splice(i,1)}var r={};var a=sap.ui.getCore();r.Desctination=a.byId("inputActivityDestination").getValue();r.ActivityName=a.byId("inputActivity").getValue();r.AdultPrice=a.byId("inputActivityAdultPrice").getValue();r.NumberOfAdult=a.byId("inputActivityAdult").getValue();r.ChildPrice=a.byId("inputActivityChildPrice").getValue();r.NumberOfChild=a.byId("inputActivityChild").getValue();r.Duration=a.byId("inputActivityDuration").getValue();r.Options=a.byId("inputActivityOptions").getValue();r.PickUpDate=this.convertTodateValue(new Date(a.byId("inputActivitypickupdatetime").getDateValue()));r.PickUpTime=a.byId("inputActivitypickupdatetime").getValue().split(" ")[3];r.PickUpDateTime=a.byId("inputActivitypickupdatetime").getValue();r.PickUpZone=a.byId("inputActivityPickupzone").getValue();r.Remarks=a.byId("inputActivityRemarks").getValue();r.TotalPrice=a.byId("inputActivityTotalPrice").getValue();var n={};n.objectid=this.onGetrandomNumber();n.actiondatetime=r.PickUpDate+" "+r.PickUpTime;n.planningdate=r.PickUpDate;n.origin=r.Desctination;n.type="Activity";n.activityname=r.ActivityName;n.duration=r.Duration;n.numberofadult=r.NumberOfAdult;n.numberofchild=r.NumberOfChild;n.perpaxadultprice=r.AdultPrice;n.perpaxchildprice=r.ChildPrice;n.picuptime=r.PickUpTime;n.picupdate=r.PickUpDate;n.picupdatetime=r.PickUpDateTime;n.picuplocation=r.PickUpZone;n.option=r.Options;n.remarks=r.Remarks;n.price=r.TotalPrice;n.currency="BDT";this.getModel("mainView").getProperty("/UnSortedTourList").push(n);this.onFormatTableData();this._handleValueHelpCloseForActivity()},onConfirmFreeday:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject").ID;var t=this.getModel("mainView").getProperty("/UnSortedTourList");var i=t.map(function(e){return e.objectid}).indexOf(e);t.splice(i,1)}var r=sap.ui.getCore();var a={};var n=r.byId("FreedayDP1").getDateValue();var o=n.getMonth()+1;var l=o<10?"0"+o:o;a.ActionDay=n.getFullYear()+"."+l+"."+n.getDate();a.Suggestions=r.byId("InputFreedaySuggestions").getValue();var u={};u.objectid=this.onGetrandomNumber();u.actiondatetime=a.ActionDay+" "+"05:00:000";u.planningdate=a.ActionDay;u.suggestion=a.Suggestions;u.type="Freeday";u.price="0";u.currency="BDT";this.getModel("mainView").getProperty("/UnSortedTourList").push(u);this.onFormatTableData();this._handleValueHelpCloseForFreeday()},onConfirmVisa:function(){if(this.getModel("mainView").getProperty("/EditObject")!==""){var e=this.getModel("mainView").getProperty("/EditObject").ID;var t=this.getModel("mainView").getProperty("/UnSortedTourList");var i=t.map(function(e){return e.objectid}).indexOf(e);t.splice(i,1)}var r=sap.ui.getCore();var a={};a.CountryName=r.byId("inputVisaCountryName").getValue();a.NumberOfAdult=r.byId("inputVisanumberofadult").getValue();a.VisaFees=r.byId("InputVisaAmount").getValue();a.VisaFeesTotalPrice=r.byId("inputVisaTotalPrice").getValue();var n=new Date;var o=n.getMonth()+1;var l=o<10?"0"+o:o;var u={};u.objectid=this.onGetrandomNumber();u.actiondatetime=n.getFullYear()+"."+l+"."+n.getDate()+" "+"09:00";u.planningdate=n.getFullYear()+"."+l+"."+n.getDate();u.countryname=a.CountryName;u.type="Visa";u.numberofadult=a.NumberOfAdult;u.perpaxadultprice=a.VisaFees;u.price=a.VisaFeesTotalPrice;u.currency="BDT";this.getModel("mainView").getProperty("/UnSortedTourList").push(u);this.onFormatTableData();this._handleValueHelpCloseForVisa()},onLiveChangeVisaFeesPrice:function(e){var t=sap.ui.getCore();var i=e.getSource().getValue();var r=t.byId("inputVisanumberofadult").getValue();t.byId("inputVisaTotalPrice").setValue(parseInt(r,10)*parseInt(i,10))},onChangeVisaAdultNumber:function(e){var t=sap.ui.getCore();var i=e.getSource().getValue();var r=t.byId("InputVisaAmount").getValue();t.byId("inputVisaTotalPrice").setValue(parseInt(i,10)*parseInt(r,10))},onupdateTableFinishedForTourdetails:function(){var e=this.getModel("mainView").getProperty("/TotalTourCost");this.getView().byId("totalCostObj").setText(e);if(parseInt(e,10)>0){this.getView().byId("btnInvoice").setVisible(true)}else{this.getView().byId("btnInvoice").setVisible(false)}},onFormatTableData:function(){var e=this.getModel("mainView").getProperty("/UnSortedTourList").sort(function(e,t){var i=e.actiondatetime.split(" ")[0];var r=e.actiondatetime.split(" ")[1];var a=t.actiondatetime.split(" ")[0];var n=t.actiondatetime.split(" ")[1];var o=new Date(i.split(".")[0],parseInt(i.split(".")[1],10)-1,i.split(".")[2],r.split(":")[0],r.split(":")[1]);var l=new Date(a.split(".")[0],parseInt(a.split(".")[1],10)-1,a.split(".")[2],n.split(":")[0],n.split(":")[1]);return o-l});this.getModel("mainView").setProperty("/SortedTourList",e);this.onLoadDataForTripDetailsNew()},onLoadDataForTripDetailsNew:function(){var e=this;var t=this.getView().byId("tbltrip");t.destroyItems();this.getModel("mainView").setProperty("/EditObject","");this.getModel("mainView").setProperty("/RoundFlights",[]);this.getModel("mainView").setProperty("/RoundHotels",[]);var i=0;t.bindAggregation("items","mainView>/SortedTourList",function(t,r){var a="";var n=r.getProperty("type");if(n==="Transfer"){var o={};o.ObjectId=r.getProperty("objectid");o.Origin=r.getProperty("origin");o.Destination=r.getProperty("destination");o.PickupTime=r.getProperty("picuptime");o.PickUpDateTime=r.getProperty("pickupdatetime");o.Price=e.numberWithCommas(r.getProperty("price"));o.IndividualPrice=e.numberWithCommas(r.getProperty("individualprice"));o.Currency=r.getProperty("currency");o.PlanningDate=e.converttoNewdateFormat(r.getProperty("planningdate"));o.ObjectType=r.getProperty("type");o.VehicleType=r.getProperty("vehicletype");o.NumberofVehicle=r.getProperty("numberofvehicle");o.ServiceType=r.getProperty("vechileservicetype");o.PickupZone=r.getProperty("picupzone");o.Remarks=r.getProperty("remarks");a=e.onLoadCarTemplate(o);i=i+parseInt(r.getProperty("price"),10);e.getModel("mainView").setProperty("/TotalTourCost",i)}if(n==="Flight"){var l={};l.ObjectId=r.getProperty("objectid");l.Origin=r.getProperty("origin");l.Destination=r.getProperty("destination");l.Price=e.numberWithCommas(r.getProperty("price"));l.Currency=r.getProperty("currency");l.PlanningDate=e.converttoNewdateFormat(r.getProperty("planningdate"));l.ObjectType=r.getProperty("type");l.FlightType=r.getProperty("flighttype");l.FlightNumber=r.getProperty("departureflightnumber");l.CarrierName=r.getProperty("carriername");l.NoOfAdult=r.getProperty("numberofadult");l.AdultPrice=r.getProperty("adultprice");l.NoOfChild=r.getProperty("numberofchild");l.ChildPrice=r.getProperty("childprice");l.NoOfInfant=r.getProperty("numberofinfant");l.InfantPrice=r.getProperty("infantprice");l.DepartureDateTime=r.getProperty("departuredatetime");l.DepartureDate=e.converttoNewdateFormat(r.getProperty("departuredate"));l.DepartureTime=r.getProperty("departuretime");l.Remarks=r.getProperty("remarks");a=e.onLoadFlightTemplate(l);var u=e.getModel("mainView").getProperty("/RoundFlights");if(l.FlightType==="round"&&u.indexOf(l.ObjectId)===-1){e.getModel("mainView").getProperty("/RoundFlights").push(l.ObjectId);i=i+parseInt(r.getProperty("price"),10)}else if(l.FlightType==="oneway"){i=i+parseInt(r.getProperty("price"),10)}e.getModel("mainView").setProperty("/TotalTourCost",i)}else if(n==="Hotel"){var s={};s.ObjectId=r.getProperty("objectid");s.CheckInDate=e.converttoNewdateFormat(r.getProperty("checkindate"));s.CheckOutDate=e.converttoNewdateFormat(r.getProperty("checkoutdate"));s.CheckInOutDate=r.getProperty("checkinoutdate");s.NumberOfNights=r.getProperty("numberofnight");s.HotelName=r.getProperty("hotelname");s.Location=r.getProperty("hotellocation");s.RoomType=r.getProperty("roomtype");s.Price=e.numberWithCommas(r.getProperty("price"));s.Currency=r.getProperty("currency");s.PlanningDate=e.converttoNewdateFormat(r.getProperty("planningdate"));s.ObjectType=r.getProperty("type");s.NumberOfAdult=r.getProperty("numberofadult");s.NumberOfChild=r.getProperty("numberofchild");s.ConfirmationNumber=r.getProperty("confirmationnumber");s.HotelAddress=r.getProperty("hoteladdress");s.NumberOfRooms=r.getProperty("numberofrooms");s.NumberOfExtraBed=r.getProperty("numberofextrabed");s.Remarks=r.getProperty("remarks");s.PerdayPrice=e.numberWithCommas(r.getProperty("roomperdayprice"));s.ExtraBedPrice=e.numberWithCommas(r.getProperty("extrabedprice"));a=e.onLoadHotelTemplate(s);var d=e.getModel("mainView").getProperty("/RoundHotels");if(d.indexOf(s.ObjectId)===-1){e.getModel("mainView").getProperty("/RoundHotels").push(s.ObjectId);i=i+parseInt(r.getProperty("price"),10)}e.getModel("mainView").setProperty("/TotalTourCost",i)}else if(n==="Activity"){var p={};p.ObjectId=r.getProperty("objectid");p.Origin=r.getProperty("origin");p.ActivityName=r.getProperty("activityname");p.Duration=r.getProperty("duration");p.Adult=r.getProperty("numberofadult");p.Child=r.getProperty("numberofchild");p.Totalpax=parseInt(p.Adult,10)+parseInt(p.Child,10);p.AdultTicketPrice=e.numberWithCommas(r.getProperty("perpaxadultprice"));p.ChildTicketPrice=e.numberWithCommas(r.getProperty("perpaxchildprice"));p.PickupTime=r.getProperty("picuptime");p.PickUpDateTime=r.getProperty("picupdatetime");p.PickupZone=r.getProperty("picuploation");p.Option=r.getProperty("option");p.Remarks=r.getProperty("remarks");p.Currency=r.getProperty("currency");p.PlanningDate=e.converttoNewdateFormat(r.getProperty("planningdate"));p.ObjectType=r.getProperty("type");p.TotalPrice=e.numberWithCommas(r.getProperty("price"));a=e.onLoadActivityTemplate(p);i=i+parseInt(r.getProperty("price"),10);e.getModel("mainView").setProperty("/TotalTourCost",i)}else if(n==="Visa"){var g={};g.ObjectId=r.getProperty("objectid");g.CountryName=r.getProperty("countryname");g.Adult=r.getProperty("numberofadult");g.Currency=r.getProperty("currency");g.Fees=r.getProperty("perpaxadultprice");g.PlanningDate=e.converttoNewdateFormat(r.getProperty("planningdate"));g.ObjectType=r.getProperty("type");g.TotalPrice=e.numberWithCommas(r.getProperty("price"));a=e.onLoadVisaTemplate(g);i=i+parseInt(r.getProperty("price"),10);e.getModel("mainView").setProperty("/TotalTourCost",i)}else if(n==="Freeday"){var c={};c.ObjectId=r.getProperty("objectid");c.Suggestion=r.getProperty("suggestion");c.Currency=r.getProperty("currency");c.PlanningDate=e.converttoNewdateFormat(r.getProperty("planningdate"));c.ObjectType=r.getProperty("type");c.TotalPrice=e.numberWithCommas(r.getProperty("price"));a=e.onLoadFreeDayTemplate(c);i=i+parseInt(r.getProperty("price"),10);e.getModel("mainView").setProperty("/TotalTourCost",i)}return new sap.m.ColumnListItem({cells:[a,new sap.m.Text({text:""})]})})},onEditObject:function(e,t){var i=e.getSource().getParent().getParent().getParent(),r=e.getSource().getParent().getParent().getParent().getParent(),a=r.indexOfItem(i);var n={};n.Info=t;n.Index=a;n.ID=t.ObjectId;this.getModel("mainView").setProperty("/EditObject","");this.getModel("mainView").setProperty("/EditObject",n);if(t.ObjectType==="Hotel"){this.onEditHotel(e,t,a)}else if(t.ObjectType==="Transfer"){this.onEditTransfer(e,t,a)}else if(t.ObjectType==="Activity"){this.onEditActivity(e,t,a)}else if(t.ObjectType==="Visa"){this.onEditVisa(e,t,a)}else if(t.ObjectType==="Freeday"){this.onEditFreeDay(e,t,a)}else if(t.ObjectType==="Flight"){this.onEditFlight(e,t,a)}},onEditFlight:function(e,t,i){if(!this._oViewFlightDialog){this._oViewFlightDialog=sap.ui.xmlfragment("plentyHolidays.view.Hotel",this);this.getView().addDependent(this._oViewFlightDialog);this._oViewFlightDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewFlightDialog.open()},onEditHotel:function(e,t,i){if(!this._oViewHotelDialog){this._oViewHotelDialog=sap.ui.xmlfragment("plentyHolidays.view.Hotel",this);this.getView().addDependent(this._oViewHotelDialog);this._oViewHotelDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewHotelDialog.open()},onEditVisa:function(e,t,i){if(!this._oViewVisaDialog){this._oViewVisaDialog=sap.ui.xmlfragment("plentyHolidays.view.Visa",this);this.getView().addDependent(this._oViewVisaDialog);this._oViewVisaDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewVisaDialog.open()},onEditFreeDay:function(e,t,i){if(!this._oViewFreeDayDialog){this._oViewFreeDayDialog=sap.ui.xmlfragment("plentyHolidays.view.Freeday",this);this.getView().addDependent(this._oViewFreeDayDialog);this._oViewFreeDayDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewFreeDayDialog.open()},onEditTransfer:function(e,t,i){if(!this._oViewTransferDialog){this._oViewTransferDialog=sap.ui.xmlfragment("plentyHolidays.view.Transfer",this);this.getView().addDependent(this._oViewTransferDialog);this._oViewTransferDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewTransferDialog.open()},onEditActivity:function(e,t,i){if(!this._oViewActivityDialog){this._oViewActivityDialog=sap.ui.xmlfragment("plentyHolidays.view.Activity",this);this.getView().addDependent(this._oViewActivityDialog);this._oViewActivityDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewActivityDialog.open()},onProceedToInvoice:function(){var e=sap.ui.getCore();var t={};t.Name=e.byId("inputCustomerName").getValue();t.Address=e.byId("Inputcustomeraddress").getValue();t.Email=e.byId("Inputcustomeremailaddress").getValue();t.ContactNumber=e.byId("Inputcustomercontactnumber").getValue();t.Discount=e.byId("Inputcustomerdiscount").getValue();t.TripName=e.byId("Inputcustomertripname").getValue();t.Adults=e.byId("inputnumberofadult").getValue();t.Child=e.byId("inputnumberofchild").getValue();t.Infant=e.byId("inputnumberofinfant").getValue();this.getModel("Vacachi").setProperty("/CustomerInfo",{});this.getModel("Vacachi").setProperty("/CustomerInfo",t);this.getModel("Vacachi").setProperty("/ItenaryList",[]);this.getModel("Vacachi").setProperty("/TotalPrice",0);this.getModel("Vacachi").setProperty("/TotalPrice",parseInt(this.getView().byId("totalCostObj").getText(),10));this.getModel("Vacachi").setProperty("/ItenaryList",this.getModel("mainView").getProperty("/SortedTourList"));this.getRouter().navTo("object",{objectId:this.onGetrandomNumber()},true)},onCloseCustomerInfo:function(){this._oViewCusotmerDialog.close()},onShowCusotmerInformation:function(){if(!this._oViewCusotmerDialog){this._oViewCusotmerDialog=sap.ui.xmlfragment("plentyHolidays.view.CustomerInfo",this);this.getView().addDependent(this._oViewCusotmerDialog);this._oViewCusotmerDialog.addStyleClass(this.getOwnerComponent().getContentDensityClass())}this._oViewCusotmerDialog.open()}})});